<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6. Modelling Mortality • bage</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="6. Modelling Mortality">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bage</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/vig1_intro.html">1. Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/vig2_math.html">2. Mathematical Details</a></li>
    <li><a class="dropdown-item" href="../articles/vig3_priors.html">3. Priors</a></li>
    <li><a class="dropdown-item" href="../articles/vig4_svd.html">4. Singular Value Decomposition</a></li>
    <li><a class="dropdown-item" href="../articles/vig5_workflow.html">5. Bayesian Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/vig6_mortality.html">6. Modelling Mortality</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bayesiandemography/bage/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>6. Modelling Mortality</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bayesiandemography/bage/blob/main/vignettes/vig6_mortality.Rmd" class="external-link"><code>vignettes/vig6_mortality.Rmd</code></a></small>
      <div class="d-none name"><code>vig6_mortality.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we estimate mortality rates, and summary indicators
such as life expectancy. We work with data from Iceland. We try several
methods for representing age patterns, including one that uses typically
patterns from the Human Mortality Database. All our model-based
estimates come with measures of uncertainty.</p>
<p>In addition to <strong>bage</strong> itself, we need package
<strong>poputils</strong>, which contains functions for calculating life
expectancy, and <strong>rvec</strong>, which contains data structures
and functions for working with random draws.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayesiandemography.github.io/bage/">bage</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayesiandemography.github.io/poputils/" class="external-link">poputils</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bayesiandemography.github.io/rvec/" class="external-link">rvec</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'rvec'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     sd, var</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     rank</span></span></code></pre></div>
<p>We use standard tidyverse tools for data manipulation and
graphing.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-data">The data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h2>
<p>The Iceland deaths data is included in the <strong>bage</strong>
package. It contains counts of deaths, and estimates of the mid-year
population, disaggregated by age and sex, for the years 1998–2022.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dth</span> <span class="op">&lt;-</span> <span class="fu">bage</span><span class="fu">::</span><span class="va"><a href="../reference/deaths.html">deaths</a></span></span>
<span><span class="va">dth</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5,300 × 5</span></span></span>
<span><span class="co">#&gt;    age   sex     time deaths  popn</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0     Female  <span style="text-decoration: underline;">1</span>998      7 <span style="text-decoration: underline;">2</span>051 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     Female  <span style="text-decoration: underline;">1</span>998      1 <span style="text-decoration: underline;">2</span>082.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2     Female  <span style="text-decoration: underline;">1</span>998      1 <span style="text-decoration: underline;">2</span>088 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 3     Female  <span style="text-decoration: underline;">1</span>998      3 <span style="text-decoration: underline;">2</span>112.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4     Female  <span style="text-decoration: underline;">1</span>998      1 <span style="text-decoration: underline;">2</span>204 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 5     Female  <span style="text-decoration: underline;">1</span>998      0 <span style="text-decoration: underline;">2</span>232.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 6     Female  <span style="text-decoration: underline;">1</span>998      1 <span style="text-decoration: underline;">2</span>175 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 7     Female  <span style="text-decoration: underline;">1</span>998      0 <span style="text-decoration: underline;">2</span>240 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 8     Female  <span style="text-decoration: underline;">1</span>998      0 <span style="text-decoration: underline;">2</span>261 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 9     Female  <span style="text-decoration: underline;">1</span>998      0 <span style="text-decoration: underline;">2</span>182.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,290 more rows</span></span></span></code></pre></div>
<p>The oldest age group is 105 years and older.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">dth</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;   age   sex    time deaths  popn</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 103   Male   <span style="text-decoration: underline;">2</span>022      0   1.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 104   Male   <span style="text-decoration: underline;">2</span>022      1   1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 105+  Male   <span style="text-decoration: underline;">2</span>022      0   0</span></span></code></pre></div>
<p>The data is sparse. Twenty-two percent of death counts are 0, and
half are 3 or less.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dth</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">deaths</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         cumulative_percent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">percent</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   deaths     n percent cumulative_percent</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      0  <span style="text-decoration: underline;">1</span>180      22                 22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1   701      13                 35</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      2   424       8                 43</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      3   333       6                 49</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      4   239       5                 54</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      5   194       4                 58</span></span></code></pre></div>
<p>We plot ‘direct’ estimates of death rates in the first and least
years of the data. Direct estimates are calculated by dividing the
number of deaths by the corresponding population at risk, independently
for each combination of age, sex, and time. The results are shown below,
on a log scale. The dots at the bottom of the graph represent log-rates
of negative infinity, which occur in cells where no deaths were
observed. Random variation obscures any patterns before about age 50.
After age 50, rates increase more or less linearly.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dth</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1998</span>, <span class="fl">2010</span>, <span class="fl">2022</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="va">deaths</span> <span class="op">/</span> <span class="va">popn</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/age_lower.html" class="external-link">age_mid</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">rate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">## 'age_mid()' returns the mid point</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>       <span class="co">## of the age group, which is useful</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>                 <span class="co">## for plotting</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Direct estimates of mortality rates"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="vig6_mortality_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="initial-model">Initial model<a class="anchor" aria-label="anchor" href="#initial-model"></a>
</h2>
<div class="section level3">
<h3 id="specifying-the-model">Specifying the model<a class="anchor" aria-label="anchor" href="#specifying-the-model"></a>
</h3>
<p>We fit an initial simple model. In our prior model, we allow for an
interaction between age and sex, but do not allow for any interactions
involving time. We assume, in other words, that mortality rates rise or
fall at the same rate across all age-sex groups. This assumption is
unlikely to be met exactly in practice, so we revisit it later. We
accept all the default priors for main effects and interactions. As can
be seen at the bottom of the printout, <code><a href="../reference/mod_pois.html">mod_pois()</a></code> has
guessed which variables represent age, sex, and time. (It bases its
guesses on the variable names.) Age and time main effects, by default,
get “random walk” priors, and other terms get “normal” priors.</p>
<p>But before running the model there is an annoying, but common,
problem with the data with.</p>
<p>It turns out there are 5 cases with non-zero deaths but zero
population.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dth</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">deaths</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">popn</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">#&gt;   age   sex     time deaths  popn</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 104   Male    <span style="text-decoration: underline;">2</span>001      1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 104   Male    <span style="text-decoration: underline;">2</span>007      1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 104   Male    <span style="text-decoration: underline;">2</span>012      1     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 104   Female  <span style="text-decoration: underline;">2</span>019      2     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 105+  Male    <span style="text-decoration: underline;">2</span>020      1     0</span></span></code></pre></div>
<p>We could edit the data directly, removing or modify these cases.
However, dealing with these cases is a modelling decision, which we
would like to include in the model itself. We make use of the fact that
exposure can be specified via a formula to modify cases where we have
deaths but no population. Our model is then</p>
<p>Our model is then</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mod_pois.html">mod_pois</a></span><span class="op">(</span><span class="va">deaths</span> <span class="op">~</span> <span class="va">age</span> <span class="op">*</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">time</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">dth</span>,</span>
<span>                 exposure <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">deaths</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">popn</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="va">popn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_base</span></span>
<span><span class="co">#&gt; -- Unfitted Poisson model --</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      deaths ~ age * sex + time</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Intercept) ~ NFix()</span></span>
<span><span class="co">#&gt;         age ~ RW()</span></span>
<span><span class="co">#&gt;         sex ~ NFix()</span></span>
<span><span class="co">#&gt;        time ~ RW()</span></span>
<span><span class="co">#&gt;     age:sex ~ RW()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      dispersion: mean=1</span></span>
<span><span class="co">#&gt;        exposure: ~ifelse(deaths &gt; 0 &amp; popn == 0, 0.5, popn)</span></span>
<span><span class="co">#&gt;         var_age: age</span></span>
<span><span class="co">#&gt;   var_sexgender: sex</span></span>
<span><span class="co">#&gt;        var_time: time</span></span>
<span><span class="co">#&gt;          n_draw: 1000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mathematical-description-of-the-model">Mathematical description of the model<a class="anchor" aria-label="anchor" href="#mathematical-description-of-the-model"></a>
</h3>
<p>The model implemented by <code>mod_base</code> assumes that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>∼</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>γ</mi><mi>i</mi></msub><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
  y_i \sim \text{Poisson}(\gamma_i w_i)
\end{equation}</annotation></semantics></math> where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>i</mi></msub><annotation encoding="application/x-tex">y_i</annotation></semantics></math>
is deaths in age-sex-time cell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>w</mi><mi>i</mi></msub><annotation encoding="application/x-tex">w_i</annotation></semantics></math>
is the population at risk, and</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\gamma_i</annotation></semantics></math>
is the underlying death rate.</li>
</ul>
<p>By modelling deaths as draws from a Poisson distribution, the model
recognizes the contribution of individual-level randomness to observed
death counts. Recognizing individual-level randomness is important when
analyzing data where cell counts are small.</p>
<p>Death rates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\gamma_i</annotation></semantics></math>
are treated as draws from a Gamma distribution,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>γ</mi><mi>i</mi></msub><mo>∼</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>ξ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>,</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>ξ</mi><msub><mi>μ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
  \gamma_i \sim \text{Gamma}(\xi^{-1}, (\xi \mu_i)^{-1}).
\end{equation}</annotation></semantics></math></p>
<p>The expected value for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\gamma_i</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>,
and the variance is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi><msubsup><mi>μ</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\xi \mu_i^2</annotation></semantics></math>.
By modelling
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\gamma_i</annotation></semantics></math>
as a draw from a distribution, we are recognizing our model is only able
to explain some of the variation in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\gamma_i</annotation></semantics></math>.
Larger values for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ξ</mi><annotation encoding="application/x-tex">\xi</annotation></semantics></math>
imply more unexplained variation.</p>
<p>We model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>,
on the log scale, as a sum of factors formed from the the dimensions of
the data,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msub><mi>μ</mi><mi>i</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>0</mn></mrow><mn>4</mn></munderover><msubsup><mi>β</mi><msubsup><mi>j</mi><mi>i</mi><mi>m</mi></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup></mrow><annotation encoding="application/x-tex">\begin{equation}
  \log \mu_i = \sum_{m=0}^4 \beta_{j_i^m}^{(m)} 
\end{equation}</annotation></semantics></math> where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>𝛃</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\pmb{\beta}^{(0)}</annotation></semantics></math>
is an intercept,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>𝛃</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\pmb{\beta}^{(m)}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>⋯</mi><mo>,</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">m = 1, \cdots, 4</annotation></semantics></math>,
is a main effect or interaction, and</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>j</mi><mi>i</mi><mi>m</mi></msubsup><annotation encoding="application/x-tex">j_i^m</annotation></semantics></math>
is the element of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>𝛃</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\pmb{\beta}^{(m)}</annotation></semantics></math>
that is associated with cell
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.</li>
</ul>
<p>Each of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\beta^{(m)}</annotation></semantics></math>
in the model for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>
receives a prior. The default prior for the intercept is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>∼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><mn>10</mn><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
  \beta^{(0)} \sim \text{N}(0, 10^2)
\end{equation}</annotation></semantics></math> This prior allows for a
much broader range of values than we would expect to see in practice. We
would only rarely expect to see values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\gamma_i</annotation></semantics></math>
that were lower than 0.001 (which is -7 on a log scale) or higher than 1
(which is 0).</p>
<p>The default prior for age is a first-order random walk,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>β</mi><mi>j</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>∼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>β</mi><mrow><mi>j</mi><mo>−</mo><mn>1</mn></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>,</mo><msubsup><mi>τ</mi><mn>1</mn><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>j</mi><mo>=</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>J</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
  \beta_j^{(1)} \sim \text{N}(\beta_{j-1}^{(1)}, \tau_1^2), \quad j = 2, \dots, J_1
\end{equation}</annotation></semantics></math> A random walk prior
embodies the idea that we expect changes from one age group to the next
to be relatively small, and that neighboring age groups are more
strongly correlated than distant age groups.</p>
<p>The value for the standard deviation parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\tau_1</annotation></semantics></math>
is estimated as part of the model, and has its own prior,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>τ</mi><mn>1</mn><mn>2</mn></msubsup><mo>∼</mo><msup><mtext mathvariant="normal">N</mtext><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
    \tau_1^2 \sim \text{N}^+(0, 1)
\end{equation}</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mtext mathvariant="normal">N</mtext><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{N}^+(0, 1)</annotation></semantics></math>
denotes a half-normal distribution, that is, a normal distribution
restricted to non-negative values.</p>
<p>For this prior to be properly identified, we need to place some
constraint on the overall level. We use a soft constraint on the mean,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><msub><mi>J</mi><mn>1</mn></msub></mfrac><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>J</mi><mn>1</mn></msub></munderover><msubsup><mi>β</mi><mi>j</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mo>∼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
  \frac{1}{J_1}\sum_{j=1}^{J_1} \beta_j^{(1)} \sim \text{N}(0, 1)
\end{equation}</annotation></semantics></math></p>
<p>The sex main effect has the prior
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>β</mi><mi>j</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>τ</mi><mn>2</mn><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msubsup><mi>τ</mi><mn>2</mn><mn>2</mn></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><msup><mtext mathvariant="normal">N</mtext><mo>+</mo></msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
  \beta_j^{(2)} &amp; \sim \text{N}(0, \tau_2^2), \quad j = 1, 2 \\
  \tau_2^2 &amp; \sim \text{N}^+(0, 1)
\end{align}</annotation></semantics></math></p>
<p>The time term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\beta^{(3)}</annotation></semantics></math>
has the same random-walk prior as the age effect. The age-sex
interaction
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>β</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>4</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\beta^{(4)}</annotation></semantics></math>
has the same prior as the sex effect.</p>
<p>Finally, the dispersion term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ξ</mi><annotation encoding="application/x-tex">\xi</annotation></semantics></math>
has a penalized-complexity prior <span class="citation">[@simpson2022priors]</span>,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ξ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><msqrt><mi>ξ</mi></msqrt></mrow></mfrac><msup><mi>e</mi><mrow><mo>−</mo><msqrt><mi>ξ</mi></msqrt></mrow></msup><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
    p(\xi) = \frac{1}{2 \sqrt{\xi}}e^{-\sqrt{\xi}}.
\end{equation}</annotation></semantics></math></p>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<p>We fit the model by calling function <code><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">mod_base</span><span class="op">)</span></span>
<span><span class="va">mod_base</span></span>
<span><span class="co">#&gt; -- Fitted Poisson model --</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      deaths ~ age * sex + time</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Intercept) ~ NFix()</span></span>
<span><span class="co">#&gt;         age ~ RW()</span></span>
<span><span class="co">#&gt;         sex ~ NFix()</span></span>
<span><span class="co">#&gt;        time ~ RW()</span></span>
<span><span class="co">#&gt;     age:sex ~ RW()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      dispersion: mean=1</span></span>
<span><span class="co">#&gt;        exposure: ~ifelse(deaths &gt; 0 &amp; popn == 0, 0.5, popn)</span></span>
<span><span class="co">#&gt;         var_age: age</span></span>
<span><span class="co">#&gt;   var_sexgender: sex</span></span>
<span><span class="co">#&gt;        var_time: time</span></span>
<span><span class="co">#&gt;          n_draw: 1000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-rates">Extracting rates<a class="anchor" aria-label="anchor" href="#extracting-rates"></a>
</h3>
<p>To extract estimated rates from the fitted model object, we use
function <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aug_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">mod_base</span><span class="op">)</span></span>
<span><span class="va">aug_base</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5,300 × 8</span></span></span>
<span><span class="co">#&gt;    age   sex     time deaths  popn .observed                    .fitted</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0     Female  <span style="text-decoration: underline;">1</span>998      7 <span style="text-decoration: underline;">2</span>051   0.003<span style="text-decoration: underline;">41</span>     0.0021 (0.0016, 0.0025)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     Female  <span style="text-decoration: underline;">1</span>998      1 <span style="text-decoration: underline;">2</span>082.  0.000<span style="text-decoration: underline;">480</span>   5e-04 (0.00037, 0.00065)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2     Female  <span style="text-decoration: underline;">1</span>998      1 <span style="text-decoration: underline;">2</span>088   0.000<span style="text-decoration: underline;">479</span> 0.00026 (0.00019, 0.00036)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 3     Female  <span style="text-decoration: underline;">1</span>998      3 <span style="text-decoration: underline;">2</span>112.  0.001<span style="text-decoration: underline;">42</span>  0.00017 (0.00011, 0.00024)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4     Female  <span style="text-decoration: underline;">1</span>998      1 <span style="text-decoration: underline;">2</span>204   0.000<span style="text-decoration: underline;">454</span> 0.00012 (8.1e-05, 0.00018)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 5     Female  <span style="text-decoration: underline;">1</span>998      0 <span style="text-decoration: underline;">2</span>232.  0        0.00011 (7.3e-05, 0.00016)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 6     Female  <span style="text-decoration: underline;">1</span>998      1 <span style="text-decoration: underline;">2</span>175   0.000<span style="text-decoration: underline;">460</span> 9.6e-05 (6.2e-05, 0.00014)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 7     Female  <span style="text-decoration: underline;">1</span>998      0 <span style="text-decoration: underline;">2</span>240   0        7.6e-05 (4.9e-05, 0.00012)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 8     Female  <span style="text-decoration: underline;">1</span>998      0 <span style="text-decoration: underline;">2</span>261   0        7.7e-05 (5.1e-05, 0.00012)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 9     Female  <span style="text-decoration: underline;">1</span>998      0 <span style="text-decoration: underline;">2</span>182.  0        8.1e-05 (5.5e-05, 0.00012)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5,290 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: .expected &lt;rdbl&lt;1000&gt;&gt;</span></span></span></code></pre></div>
<p>Function <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> starts with the original data, and
adds</p>
<ul>
<li>a column called <code>.observed</code> containing direct estimates
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mi>/</mi><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">y_i/w_i</annotation></semantics></math>),</li>
<li>a column called <code>.fitted</code> containing estimates of the
rates
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\gamma_i</annotation></semantics></math>),
and</li>
<li>a column called <code>.expected</code> containing expected values
for the rates
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_i</annotation></semantics></math>).</li>
</ul>
<p>The <code>.fitted</code> and <code>.expected</code> columns both
consist of <a href="https://bayesiandemography.github.io/rvec/reference/rvec.html" class="external-link">rvecs</a>.
An rvec is a vector-like object that holds multiple draws, in this case
draws from posterior distributions.</p>
<p>Next we extract rates estimates for selected years, and summarize the
posterior distributions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rates_base</span> <span class="op">&lt;-</span> <span class="va">aug_base</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1998</span>, <span class="fl">2010</span>, <span class="fl">2022</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">sex</span>, <span class="va">time</span>, <span class="va">.observed</span>, <span class="va">.fitted</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://bayesiandemography.github.io/rvec/reference/draws_ci.html" class="external-link">draws_ci</a></span><span class="op">(</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rates_base</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 636 × 8</span></span></span>
<span><span class="co">#&gt;    age   sex     time .observed                    .fitted .fitted.lower</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 0     Female  <span style="text-decoration: underline;">1</span>998  0.003<span style="text-decoration: underline;">41</span>     0.0021 (0.0016, 0.0025)     0.001<span style="text-decoration: underline;">63</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1     Female  <span style="text-decoration: underline;">1</span>998  0.000<span style="text-decoration: underline;">480</span>   5e-04 (0.00037, 0.00065)     0.000<span style="text-decoration: underline;">374</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2     Female  <span style="text-decoration: underline;">1</span>998  0.000<span style="text-decoration: underline;">479</span> 0.00026 (0.00019, 0.00036)     0.000<span style="text-decoration: underline;">189</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 3     Female  <span style="text-decoration: underline;">1</span>998  0.001<span style="text-decoration: underline;">42</span>  0.00017 (0.00011, 0.00024)     0.000<span style="text-decoration: underline;">112</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 4     Female  <span style="text-decoration: underline;">1</span>998  0.000<span style="text-decoration: underline;">454</span> 0.00012 (8.1e-05, 0.00018)     0.000<span style="text-decoration: underline;">081</span>1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 5     Female  <span style="text-decoration: underline;">1</span>998  0        0.00011 (7.3e-05, 0.00016)     0.000<span style="text-decoration: underline;">073</span>2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 6     Female  <span style="text-decoration: underline;">1</span>998  0.000<span style="text-decoration: underline;">460</span> 9.6e-05 (6.2e-05, 0.00014)     0.000<span style="text-decoration: underline;">062</span>1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 7     Female  <span style="text-decoration: underline;">1</span>998  0        7.6e-05 (4.9e-05, 0.00012)     0.000<span style="text-decoration: underline;">048</span>8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 8     Female  <span style="text-decoration: underline;">1</span>998  0        7.7e-05 (5.1e-05, 0.00012)     0.000<span style="text-decoration: underline;">051</span>1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 9     Female  <span style="text-decoration: underline;">1</span>998  0        8.1e-05 (5.5e-05, 0.00012)     0.000<span style="text-decoration: underline;">055</span>3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 626 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: .fitted.mid &lt;dbl&gt;, .fitted.upper &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We plot point estimates and 95% credible intervals for the modelled
estimates, together with the original direct estimates,</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rates_base</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/age_lower.html" class="external-link">age_mid</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, </span>
<span>             ymin <span class="op">=</span> <span class="va">.fitted.lower</span>,</span>
<span>             y <span class="op">=</span> <span class="va">.fitted.mid</span>,</span>
<span>             ymax <span class="op">=</span> <span class="va">.fitted.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>col<span class="op">=</span> <span class="st">"darkblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.observed</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Modelled and direct estimates of mortality rates - base model"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="vig6_mortality_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="extracting-higher-level-terms">Extracting higher-level terms<a class="anchor" aria-label="anchor" href="#extracting-higher-level-terms"></a>
</h3>
<p>We can gain insights into the model by extracting and graphing
estimates of the main effects and interactions, the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>𝛃</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">\pmb{\beta}^{(m)}</annotation></semantics></math>.</p>
<p>Estimates of the main effects and interactions, and of other
higher-level parameters, can be obtained with function
<code><a href="https://generics.r-lib.org/reference/components.html" class="external-link">components()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/components.html" class="external-link">components</a></span><span class="op">(</span><span class="va">mod_base</span><span class="op">)</span></span>
<span><span class="va">comp_base</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 350 × 4</span></span></span>
<span><span class="co">#&gt;    term        component level                 .fitted</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> (Intercept) effect    (Intercept) -5.4 (-5.5, -5.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> age         effect    0           -0.86 (-1, -0.72)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> age         effect    1             -2.3 (-2.5, -2)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> age         effect    2           -2.9 (-3.2, -2.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> age         effect    3           -3.4 (-3.7, -3.1)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> age         effect    4             -3.7 (-4, -3.3)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> age         effect    5           -3.7 (-4.1, -3.4)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> age         effect    6           -3.9 (-4.2, -3.5)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> age         effect    7           -4.1 (-4.5, -3.7)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> age         effect    8             -4 (-4.4, -3.7)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 340 more rows</span></span></span></code></pre></div>
<p><code><a href="https://generics.r-lib.org/reference/components.html" class="external-link">components()</a></code> returns a tibble contain estimates of all
the higher-level parameters. To extract the age effect, and prepare it
for graphing, we use</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_effect</span> <span class="op">&lt;-</span> <span class="va">comp_base</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"effect"</span>,</span>
<span>         <span class="va">term</span> <span class="op">==</span> <span class="st">"age"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://bayesiandemography.github.io/rvec/reference/draws_ci.html" class="external-link">draws_ci</a></span><span class="op">(</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>A graph of the age effect reveals a typical profile for mortality
rates,</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">age_effect</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/age_lower.html" class="external-link">age_mid</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span>,</span>
<span>           y <span class="op">=</span> <span class="va">.fitted.mid</span>,</span>
<span>           ymin <span class="op">=</span> <span class="va">.fitted.lower</span>,</span>
<span>           ymax <span class="op">=</span> <span class="va">.fitted.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Age effect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig6_mortality_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="revised-model">Revised model<a class="anchor" aria-label="anchor" href="#revised-model"></a>
</h2>
<div class="section level3">
<h3 id="mathematical-structure">Mathematical structure<a class="anchor" aria-label="anchor" href="#mathematical-structure"></a>
</h3>
<p>The <a href="https://www.mortality.org" class="external-link">Human Mortality Database</a>
provides estimates of mortality rates for many countries. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐌</mi><annotation encoding="application/x-tex">\pmb{M}</annotation></semantics></math>
denote a matrix holding these estimates, on a log scale. By applying a
<a href="https://en.wikipedia.org/wiki/Singular_value_decomposition" class="external-link">Singlar
Value Decomposition</a> to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐌</mi><annotation encoding="application/x-tex">\pmb{M}</annotation></semantics></math>,
and then rescaling, we can construct a matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐅</mi><annotation encoding="application/x-tex">\pmb{F}</annotation></semantics></math>
and a column vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐠</mi><annotation encoding="application/x-tex">\pmb{g}</annotation></semantics></math>,
that parsimoniously summarize the age-profiles, or age-sex profiles,
that are observed in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐌</mi><annotation encoding="application/x-tex">\pmb{M}</annotation></semantics></math>.
If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
is a vector of independent draws from a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{N}(0,1)</annotation></semantics></math>
distribution, then the resulting vector
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐦</mi><mo>=</mo><mi>𝐅</mi><mi>𝐳</mi><mo>+</mo><mi>𝐠</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
  \pmb{m} = \pmb{F} \pmb{z} + \pmb{g}
\end{equation}</annotation></semantics></math> looks like a
randomly-selected column from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐌</mi><annotation encoding="application/x-tex">\pmb{M}</annotation></semantics></math>.</p>
<p>We use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐅</mi><annotation encoding="application/x-tex">\pmb{F}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐠</mi><annotation encoding="application/x-tex">\pmb{g}</annotation></semantics></math>
to build priors for age effects and age-sex interactions. The prior for
age effects is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msup><mi>𝛃</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>𝐅</mi><mi>𝛂</mi><mo>+</mo><mi>𝐠</mi></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>α</mi><mi>k</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">N</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>⋯</mi><mo>,</mo><mi>K</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
  \pmb{\beta}^{(1)} &amp; = \pmb{F} \pmb{\alpha} + \pmb{g} \\
  \alpha_k &amp; \sim \text{N}(0, 1), \quad k = 1, \cdots, K
\end{align}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
is chosen by the user. The prior for age-sex interactions looks the same
except that, by default, the calculations are done separately for each
sex.</p>
</div>
<div class="section level3">
<h3 id="specifying-the-new-model">Specifying the new model<a class="anchor" aria-label="anchor" href="#specifying-the-new-model"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_hmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mod_pois.html">mod_pois</a></span><span class="op">(</span><span class="va">deaths</span> <span class="op">~</span> <span class="va">age</span><span class="op">:</span><span class="va">sex</span> <span class="op">+</span> <span class="va">time</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">dth</span>,</span>
<span>                    exposure <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">deaths</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">popn</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0.5</span>, <span class="va">popn</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/set_prior.html">set_prior</a></span><span class="op">(</span><span class="va">age</span><span class="op">:</span><span class="va">sex</span> <span class="op">~</span> <span class="fu"><a href="../reference/SVD.html">SVD</a></span><span class="op">(</span><span class="va">HMD</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod_hmd</span></span>
<span><span class="co">#&gt; -- Unfitted Poisson model --</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      deaths ~ age:sex + time</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Intercept) ~ NFix()</span></span>
<span><span class="co">#&gt;        time ~ RW()</span></span>
<span><span class="co">#&gt;     age:sex ~ SVD(HMD)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      dispersion: mean=1</span></span>
<span><span class="co">#&gt;        exposure: ~ifelse(deaths &gt; 0 &amp; popn == 0, 0.5, popn)</span></span>
<span><span class="co">#&gt;         var_age: age</span></span>
<span><span class="co">#&gt;   var_sexgender: sex</span></span>
<span><span class="co">#&gt;        var_time: time</span></span>
<span><span class="co">#&gt;          n_draw: 1000</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_hmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">mod_hmd</span><span class="op">)</span></span>
<span><span class="va">mod_hmd</span></span>
<span><span class="co">#&gt; -- Fitted Poisson model --</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      deaths ~ age:sex + time</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Intercept) ~ NFix()</span></span>
<span><span class="co">#&gt;        time ~ RW()</span></span>
<span><span class="co">#&gt;     age:sex ~ SVD(HMD)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      dispersion: mean=1</span></span>
<span><span class="co">#&gt;        exposure: ~ifelse(deaths &gt; 0 &amp; popn == 0, 0.5, popn)</span></span>
<span><span class="co">#&gt;         var_age: age</span></span>
<span><span class="co">#&gt;   var_sexgender: sex</span></span>
<span><span class="co">#&gt;        var_time: time</span></span>
<span><span class="co">#&gt;          n_draw: 1000</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aug_hmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="va">mod_hmd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rates_hmd</span> <span class="op">&lt;-</span> <span class="va">aug_hmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1998</span>, <span class="fl">2010</span>, <span class="fl">2022</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">sex</span>, <span class="va">time</span>, <span class="va">.observed</span>, <span class="va">.fitted</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://bayesiandemography.github.io/rvec/reference/draws_ci.html" class="external-link">draws_ci</a></span><span class="op">(</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rates_hmd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/age_lower.html" class="external-link">age_mid</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, </span>
<span>             ymin <span class="op">=</span> <span class="va">.fitted.lower</span>,</span>
<span>             y <span class="op">=</span> <span class="va">.fitted.mid</span>,</span>
<span>             ymax <span class="op">=</span> <span class="va">.fitted.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>col<span class="op">=</span> <span class="st">"darkblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">.observed</span><span class="op">)</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Modelled and direct estimates of mortality rates - HMD model"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="vig6_mortality_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comp_hmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/components.html" class="external-link">components</a></span><span class="op">(</span><span class="va">mod_hmd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">age_sex_interact</span> <span class="op">&lt;-</span> <span class="va">comp_hmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">component</span> <span class="op">==</span> <span class="st">"effect"</span>,</span>
<span>         <span class="va">term</span> <span class="op">==</span> <span class="st">"age:sex"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_wider_delim.html" class="external-link">separate_wider_delim</a></span><span class="op">(</span><span class="va">level</span>, delim <span class="op">=</span> <span class="st">"."</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://bayesiandemography.github.io/rvec/reference/draws_ci.html" class="external-link">draws_ci</a></span><span class="op">(</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">age_sex_interact</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/age_lower.html" class="external-link">age_mid</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>           y <span class="op">=</span> <span class="va">.fitted.mid</span>,</span>
<span>           ymin <span class="op">=</span> <span class="va">.fitted.lower</span>,</span>
<span>           ymax <span class="op">=</span> <span class="va">.fitted.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Age-sex interaction"</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig6_mortality_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="model-testing">Model testing<a class="anchor" aria-label="anchor" href="#model-testing"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_data_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/replicate_data.html">replicate_data</a></span><span class="op">(</span><span class="va">mod_base</span>, condition_on <span class="op">=</span> <span class="st">"meanpar"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">rep_data_base</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="fl">2022</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">popn</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sex</span>, values_from <span class="op">=</span> <span class="va">deaths</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>diff <span class="op">=</span> <span class="va">Female</span> <span class="op">-</span> <span class="va">Male</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/age_lower.html" class="external-link">age_mid</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">.replicate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig6_mortality_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rep_data_hmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/replicate_data.html">replicate_data</a></span><span class="op">(</span><span class="va">mod_hmd</span>, condition_on <span class="op">=</span> <span class="st">"meanpar"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">rep_data_hmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="fl">2022</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">popn</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sex</span>, values_from <span class="op">=</span> <span class="va">deaths</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>diff <span class="op">=</span> <span class="va">Female</span> <span class="op">-</span> <span class="va">Male</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/age_lower.html" class="external-link">age_mid</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">.replicate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="vig6_mortality_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="life-expectancy-and-life-tables">Life expectancy and life tables<a class="anchor" aria-label="anchor" href="#life-expectancy-and-life-tables"></a>
</h2>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeexp_hmd</span> <span class="op">&lt;-</span> <span class="va">mod_hmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/lifetab.html" class="external-link">lifeexp</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">.fitted</span>,</span>
<span>          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lifeexp_hmd</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 3</span></span></span>
<span><span class="co">#&gt;     time sex              ex</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">1</span>998 Female  82 (81, 82)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">1</span>998 Male    78 (77, 78)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">1</span>999 Female  82 (81, 82)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>999 Male    78 (77, 78)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>000 Female  82 (82, 82)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>000 Male    78 (78, 79)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>001 Female  82 (82, 83)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>001 Male    79 (78, 79)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>002 Female  82 (82, 83)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>002 Male    79 (78, 79)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lifeexp_hmd</span> <span class="op">&lt;-</span> <span class="va">mod_hmd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://bayesiandemography.github.io/poputils/reference/lifetab.html" class="external-link">lifeexp</a></span><span class="op">(</span>mx <span class="op">=</span> <span class="va">.fitted</span>,</span>
<span>          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lifeexp_hmd</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 50 × 3</span></span></span>
<span><span class="co">#&gt;     time sex              ex</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">1</span>998 Female  82 (81, 82)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">1</span>998 Male    78 (77, 78)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">1</span>999 Female  82 (81, 82)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">1</span>999 Male    78 (77, 78)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>000 Female  82 (82, 82)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>000 Male    78 (78, 79)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>001 Female  82 (82, 83)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>001 Male    79 (78, 79)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>002 Female  82 (82, 83)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>002 Male    79 (78, 79)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 40 more rows</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Bryant, Junni Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
