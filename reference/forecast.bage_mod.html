<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Use a Model to Make a Forecast — forecast.bage_mod • bage</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use a Model to Make a Forecast — forecast.bage_mod"><meta name="description" content="Forecast rates, probabilities, means, and
other model parameters."><meta property="og:description" content="Forecast rates, probabilities, means, and
other model parameters."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bage</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/vig1_intro.html">1. Overview</a></li>
    <li><a class="dropdown-item" href="../articles/vig2_math.html">2. Mathematical Details</a></li>
    <li><a class="dropdown-item" href="../articles/vig3_priors.html">3. Priors</a></li>
    <li><a class="dropdown-item" href="../articles/vig4_svd.html">4. Singular Value Decomposition</a></li>
    <li><a class="dropdown-item" href="../articles/vig5_bdef.html">5. Examples from BDEF Book</a></li>
    <li><a class="dropdown-item" href="../articles/vig6_mortality.html">6. Modelling Mortality</a></li>
    <li><a class="dropdown-item" href="../articles/vig7_simulation.html">7. Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/vig8_workflow.html">8. Bayesian Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/vig9_covariates.html">9. Covariates</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bayesiandemography/bage/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Use a Model to Make a Forecast</h1>
      <small class="dont-index">Source: <a href="https://github.com/bayesiandemography/bage/blob/main/R/bage_mod-methods.R" class="external-link"><code>R/bage_mod-methods.R</code></a></small>
      <div class="d-none name"><code>forecast.bage_mod.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Forecast rates, probabilities, means, and
other model parameters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'bage_mod'</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"augment"</span>, <span class="st">"components"</span><span class="op">)</span>,</span>
<span>  include_estimates <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A <code>bage_mod</code> object,
typically created with <code><a href="mod_pois.html">mod_pois()</a></code>,
<code><a href="mod_binom.html">mod_binom()</a></code>, or <code><a href="mod_norm.html">mod_norm()</a></code>.</p></dd>


<dt id="arg-newdata">newdata<a class="anchor" aria-label="anchor" href="#arg-newdata"></a></dt>
<dd><p>Data frame with data for
future periods.</p></dd>


<dt id="arg-labels">labels<a class="anchor" aria-label="anchor" href="#arg-labels"></a></dt>
<dd><p>Labels for future values.</p></dd>


<dt id="arg-output">output<a class="anchor" aria-label="anchor" href="#arg-output"></a></dt>
<dd><p>Type of output returned</p></dd>


<dt id="arg-include-estimates">include_estimates<a class="anchor" aria-label="anchor" href="#arg-include-estimates"></a></dt>
<dd><p>Whether to
include historical estimates along
with the forecasts. Default is <code>FALSE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Not currently used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="https://tibble.tidyverse.org/reference/tibble-package.html" class="external-link">tibble</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="how-the-forecasts-are-constructed">How the forecasts are constructed<a class="anchor" aria-label="anchor" href="#how-the-forecasts-are-constructed"></a></h2>



<p>Internally, the steps involved in a forecast are:</p><ol><li><p>Forecast time-varying main effects and interactions,
e.g. a time main effect, or an age-time interaction.</p></li>
<li><p>Combine forecasts for the time-varying main effects and
interactions with non-time-varying parameters, e.g.
age effects or dispersion.</p></li>
<li><p>Use the combined parameters to generate values for
rates, probabilities or means.</p></li>
<li><p>Optionally, generate values for the outcome variable.</p></li>
</ol><p><code><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast()</a></code> generates values for the outcome variable when,</p><ul><li><p><code>output</code> is <code>"augment"</code>,</p></li>
<li><p>a value has been supplied for <code>newdata</code>,</p></li>
<li><p><code>newdata</code> included a value for the exposure,
size, or weights variable (except if <code>exposure = 1</code>
or <code>weights = 1</code> in the original call to
<code><a href="mod_pois.html">mod_pois()</a></code> or <code><a href="mod_norm.html">mod_norm()</a></code>).</p></li>
</ul><p><a href="https://bayesiandemography.github.io/bage/articles/vig2_math.html">Mathematical Details</a>
gives more details on the internal calculations in forecasting.</p>
    </div>
    <div class="section level2">
    <h2 id="output-format">Output format<a class="anchor" aria-label="anchor" href="#output-format"></a></h2>



<p>When <code>output</code> is <code>"augment"</code> (the default),
the return value from <code><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast()</a></code>
looks like output from function <code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code>. When <code>output</code> is
<code>"components"</code>, the return value looks like output
from <code><a href="https://generics.r-lib.org/reference/components.html" class="external-link">components()</a></code>.</p>
<p>When <code>include_estimates</code> is <code>FALSE</code> (the default),
the output of <code><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast()</a></code> excludes values for
time-varying parameters for the period covered by the data.
When <code>include_estimates</code> is <code>TRUE</code>, the output
includes these values.
Setting <code>include_estimates</code> to <code>TRUE</code> can be helpful
when creating graphs that combine estimates and forecasts.</p>
    </div>
    <div class="section level2">
    <h2 id="forecasting-with-covariates">Forecasting with covariates<a class="anchor" aria-label="anchor" href="#forecasting-with-covariates"></a></h2>



<p>Models that contain <a href="set_covariates.html">covariates</a> can be used
in forecasts, provided that</p><ul><li><p>all coefficients (the \(\zeta_p\)) are estimated
from historical data via <code><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit()</a></code>, and</p></li>
<li><p>if any covariates (the columns of \(\pmb{Z}\))
are time-varying, then future values for these
covariates are supplied via the <code>newdata</code> argument.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="fitted-and-unfitted-models">Fitted and unfitted models<a class="anchor" aria-label="anchor" href="#fitted-and-unfitted-models"></a></h2>



<p><code><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast()</a></code> is typically used with a
<a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fitted</a> model, i.e. a model in which parameter
values have been estimated from the data.
The resulting forecasts reflect data and priors.</p>
<p><code><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast()</a></code> can, however, be used with an
unfitted model. In this case, the forecasts
are based entirely on the priors. See below for
an example. Experimenting with forecasts
based entirely on the priors can be helpful for
choosing an appropriate model.</p>
    </div>
    <div class="section level2">
    <h2 id="warning">Warning<a class="anchor" aria-label="anchor" href="#warning"></a></h2>



<p>The interface for <code><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast()</a></code> has not been finalised.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="mod_pois.html">mod_pois()</a></code> Specify a Poisson model</p></li>
<li><p><code><a href="mod_binom.html">mod_binom()</a></code> Specify a binomial model</p></li>
<li><p><code><a href="mod_norm.html">mod_norm()</a></code> Specify a normal model</p></li>
<li><p><code><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit()</a></code> Fit a model</p></li>
<li><p><code><a href="https://generics.r-lib.org/reference/augment.html" class="external-link">augment()</a></code> Extract values for rates,
probabilities, or means, together
with original data</p></li>
<li><p><code><a href="https://generics.r-lib.org/reference/components.html" class="external-link">components()</a></code> Extract values for hyper-parameters</p></li>
<li><p><a href="https://bayesiandemography.github.io/bage/articles/vig2_math.html">Mathematical Details</a>
vignette</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## specify and fit model</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="mod_pois.html">mod_pois</a></span><span class="op">(</span><span class="va">injuries</span> <span class="op">~</span> <span class="va">age</span> <span class="op">*</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">year</span>,</span></span>
<span class="r-in"><span>                data <span class="op">=</span> <span class="va">nzl_injuries</span>,</span></span>
<span class="r-in"><span>                exposure <span class="op">=</span> <span class="va">popn</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building log-posterior function...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding maximum...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Drawing values for hyper-parameters...</span>
<span class="r-in"><span><span class="va">mod</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ------ Fitted Poisson model ------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    injuries ~ age * sex + ethnicity + year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   exposure = popn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         term  prior along n_par n_par_free std_dev</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (Intercept) NFix()     -     1          1       -</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          age   RW()   age    12         12    0.73</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          sex NFix()     -     2          2    0.11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ethnicity NFix()     -     2          2    0.45</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         year   RW()  year    19         19    0.09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      age:sex   RW()   age    24         24    0.43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  disp: mean = 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  n_draw var_time var_age var_sexgender optimizer</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    1000     year     age           sex    nlminb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  time_total time_max time_draw iter converged                    message</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        0.50     0.22      0.23   14      TRUE   relative convergence (4)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## forecasts</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fl">2019</span><span class="op">:</span><span class="fl">2024</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for past values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for future values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `augment()` for future values...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 288 × 9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    age   sex   ethnicity  year injuries  popn .observed                  .fitted</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 0-4   Fema… Maori      <span style="text-decoration: underline;">2</span>019       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 2e-04 (0.00014, 0.00026)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 0-4   Fema… Maori      <span style="text-decoration: underline;">2</span>020       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 2e-04 (0.00014, 0.00027)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 0-4   Fema… Maori      <span style="text-decoration: underline;">2</span>021       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 2e-04 (0.00014, 0.00028)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 0-4   Fema… Maori      <span style="text-decoration: underline;">2</span>022       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 2e-04 (0.00013, 0.00028)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 0-4   Fema… Maori      <span style="text-decoration: underline;">2</span>023       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 2e-04 (0.00013, 0.00028)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 0-4   Fema… Maori      <span style="text-decoration: underline;">2</span>024       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 2e-04 (0.00014, 0.00029)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 0-4   Fema… Non Maori  <span style="text-decoration: underline;">2</span>019       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 1e-04 (7.4e-05, 0.00014)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 0-4   Fema… Non Maori  <span style="text-decoration: underline;">2</span>020       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 1e-04 (7.2e-05, 0.00014)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 0-4   Fema… Non Maori  <span style="text-decoration: underline;">2</span>021       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 1e-04 (7.2e-05, 0.00015)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 0-4   Fema… Non Maori  <span style="text-decoration: underline;">2</span>022       <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        <span style="color: #BB0000;">NA</span> 1e-04 (7.1e-05, 0.00014)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 278 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1 more variable: .expected &lt;rdbl&lt;1000&gt;&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## combined estimates and forecasts</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fl">2019</span><span class="op">:</span><span class="fl">2024</span>,</span></span>
<span class="r-in"><span>           include_estimates <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for past values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for future values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `augment()` for future values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `augment()` for past values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Drawing `.expected`...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `augment()` for past values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Drawing `.fitted`...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `augment()` for past values...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1,200 × 9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    age   sex    ethnicity  year injuries  popn .observed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 0-4   Female Maori      <span style="text-decoration: underline;">2</span>000       12 <span style="text-decoration: underline;">35</span>830 0.000<span style="text-decoration: underline;">335</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 5-9   Female Maori      <span style="text-decoration: underline;">2</span>000        6 <span style="text-decoration: underline;">35</span>120 0.000<span style="text-decoration: underline;">171</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 10-14 Female Maori      <span style="text-decoration: underline;">2</span>000        3 <span style="text-decoration: underline;">32</span>830 0.000<span style="text-decoration: underline;">091</span>4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 15-19 Female Maori      <span style="text-decoration: underline;">2</span>000        6 <span style="text-decoration: underline;">27</span>130 0.000<span style="text-decoration: underline;">221</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 20-24 Female Maori      <span style="text-decoration: underline;">2</span>000        6 <span style="text-decoration: underline;">24</span>380 0.000<span style="text-decoration: underline;">246</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 25-29 Female Maori      <span style="text-decoration: underline;">2</span>000        6 <span style="text-decoration: underline;">24</span>160 0.000<span style="text-decoration: underline;">248</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 30-34 Female Maori      <span style="text-decoration: underline;">2</span>000       12 <span style="text-decoration: underline;">22</span>560 0.000<span style="text-decoration: underline;">532</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 35-39 Female Maori      <span style="text-decoration: underline;">2</span>000        3 <span style="text-decoration: underline;">22</span>230 0.000<span style="text-decoration: underline;">135</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 40-44 Female Maori      <span style="text-decoration: underline;">2</span>000        6 <span style="text-decoration: underline;">18</span>130 0.000<span style="text-decoration: underline;">331</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 45-49 Female Maori      <span style="text-decoration: underline;">2</span>000        6 <span style="text-decoration: underline;">13</span>770 0.000<span style="text-decoration: underline;">436</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1,190 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: .fitted &lt;rdbl&lt;1000&gt;&gt;, .expected &lt;rdbl&lt;1000&gt;&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## hyper-parameters</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fl">2019</span><span class="op">:</span><span class="fl">2024</span>,</span></span>
<span class="r-in"><span>           output <span class="op">=</span> <span class="st">"components"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for past values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for future values...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 4</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   term  component level          .fitted</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> year  effect    2019  -2 (-3.9, -0.42)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> year  effect    2020  -2 (-3.9, -0.44)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> year  effect    2021   -2 (-3.9, -0.4)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> year  effect    2022  -2 (-3.9, -0.39)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> year  effect    2023   -2 (-3.9, -0.4)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> year  effect    2024   -2 (-3.9, -0.4)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## hold back some data and forecast</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_historical</span> <span class="op">&lt;-</span> <span class="va">nzl_injuries</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&lt;=</span> <span class="fl">2015</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_forecast</span> <span class="op">&lt;-</span> <span class="va">nzl_injuries</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">2015</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>injuries <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="mod_pois.html">mod_pois</a></span><span class="op">(</span><span class="va">injuries</span> <span class="op">~</span> <span class="va">age</span> <span class="op">*</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">ethnicity</span> <span class="op">+</span> <span class="va">year</span>,</span></span>
<span class="r-in"><span>         data <span class="op">=</span> <span class="va">data_historical</span>,</span></span>
<span class="r-in"><span>         exposure <span class="op">=</span> <span class="va">popn</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">data_forecast</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building log-posterior function...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding maximum...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Drawing values for hyper-parameters...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for past values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for future values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `augment()` for future values...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 144 × 9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    age   sex    ethnicity  year     injuries  popn .observed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;rdbl&lt;1000&gt;&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 0-4   Female Maori      <span style="text-decoration: underline;">2</span>016    8 (3, 14) <span style="text-decoration: underline;">41</span>220        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 5-9   Female Maori      <span style="text-decoration: underline;">2</span>016     2 (0, 6) <span style="text-decoration: underline;">43</span>230        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 10-14 Female Maori      <span style="text-decoration: underline;">2</span>016     2 (0, 6) <span style="text-decoration: underline;">37</span>640        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 15-19 Female Maori      <span style="text-decoration: underline;">2</span>016   12 (5, 21) <span style="text-decoration: underline;">36</span>040        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 20-24 Female Maori      <span style="text-decoration: underline;">2</span>016   11 (4, 19) <span style="text-decoration: underline;">33</span>760        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 25-29 Female Maori      <span style="text-decoration: underline;">2</span>016    8 (2, 15) <span style="text-decoration: underline;">30</span>530        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 30-34 Female Maori      <span style="text-decoration: underline;">2</span>016    6 (2, 12) <span style="text-decoration: underline;">24</span>480        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 35-39 Female Maori      <span style="text-decoration: underline;">2</span>016    6 (2, 11) <span style="text-decoration: underline;">23</span>170        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 40-44 Female Maori      <span style="text-decoration: underline;">2</span>016    6 (2, 13) <span style="text-decoration: underline;">23</span>940        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 45-49 Female Maori      <span style="text-decoration: underline;">2</span>016    6 (2, 13) <span style="text-decoration: underline;">23</span>580        <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 134 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: .fitted &lt;rdbl&lt;1000&gt;&gt;, .expected &lt;rdbl&lt;1000&gt;&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## forecast using GDP per capita in 2023 as a covariate</span></span></span>
<span class="r-in"><span><span class="va">mod_births</span> <span class="op">&lt;-</span> <span class="fu"><a href="mod_pois.html">mod_pois</a></span><span class="op">(</span><span class="va">births</span> <span class="op">~</span> <span class="va">age</span> <span class="op">*</span> <span class="va">region</span> <span class="op">+</span> <span class="va">time</span>,</span></span>
<span class="r-in"><span>                       data <span class="op">=</span> <span class="va">kor_births</span>,</span></span>
<span class="r-in"><span>                       exposure <span class="op">=</span> <span class="va">popn</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set_covariates.html">set_covariates</a></span><span class="op">(</span><span class="op">~</span> <span class="va">gdp_pc_2023</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Building log-posterior function...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding maximum...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Drawing values for hyper-parameters...</span>
<span class="r-in"><span><span class="va">mod_births</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fl">2024</span><span class="op">:</span><span class="fl">2025</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for past values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `components()` for future values...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `augment()` for future values...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 288 × 10</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    age   region             time births  popn gdp_pc_2023 dens_2020 .observed</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 10-14 Busan              <span style="text-decoration: underline;">2</span>024     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        25.7 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 10-14 Busan              <span style="text-decoration: underline;">2</span>025     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        25.7 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 10-14 Chungcheongbuk-do  <span style="text-decoration: underline;">2</span>024     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        40.3 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 10-14 Chungcheongbuk-do  <span style="text-decoration: underline;">2</span>025     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        40.3 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 10-14 Chungcheongnam-do  <span style="text-decoration: underline;">2</span>024     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        50.4 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 10-14 Chungcheongnam-do  <span style="text-decoration: underline;">2</span>025     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        50.4 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 10-14 Daegu              <span style="text-decoration: underline;">2</span>024     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        22.3 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 10-14 Daegu              <span style="text-decoration: underline;">2</span>025     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        22.3 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 10-14 Daejeon            <span style="text-decoration: underline;">2</span>024     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        27.6 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 10-14 Daejeon            <span style="text-decoration: underline;">2</span>025     <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>        27.6 <span style="color: #BB0000;">NA</span>               <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 278 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: .fitted &lt;rdbl&lt;1000&gt;&gt;, .expected &lt;rdbl&lt;1000&gt;&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Bryant, Junni Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

